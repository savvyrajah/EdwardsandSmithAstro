---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Layout
  title="Bali Buyers Guide 2025 | Complete Villa Buying Guide | Edwards & Smith"
  description="Complete guide to buying villas in Bali. Learn about ownership options, leasehold vs freehold, PT PMA setup, legal requirements, and working with Australian buyers agents in Bali."
>
  <Header />
  <main>
    <!-- Hero Section -->
    <section class="guide-hero section">
      <div class="container">
        <h1>Bali Buyers Guide 2025</h1>
        <p class="page-subtitle">Your complete guide to buying villas in Bali</p>
      </div>
    </section>

    <!-- Breadcrumbs -->
    <section class="page-header">
      <div class="container">
        <div class="breadcrumb-row">
          <div class="breadcrumb">
            <a href="/">Home</a> / <a href="#">Bali</a> / <span>Buyers Guide</span>
          </div>
          <div class="last-updated">Last Updated: 8 October 2025</div>
        </div>
      </div>
    </section>

    <!-- Getting Started Section -->
    <section class="content-section section">
      <div class="container">
        <div class="section-header">
          <h2>Getting Started with Bali Property Investment</h2>
          <p class="section-intro">Essential preparation steps before you start your Bali villa search</p>
        </div>

        <div class="tips-grid">
          <!-- Tip 1: Understanding Foreign Ownership -->
          <div class="tip-card">
            <div class="tip-number">1</div>
            <h3>Understanding Foreign Ownership</h3>
            <p>
              Having your own villa in Bali sounds like a dream, right? This beautiful Indonesian island offers stunning beaches, waterfalls, volcanoes to hike, and green rice terraces. Bali isn't just about nature activities though – it also has a wide range of Western restaurants, lively expat communities, and a vibrant nightlife.
            </p>
            <p>
              Buying a villa in Bali is fast becoming part of that Australian dream to allow owners to live a balanced lifestyle between both countries as their careers become more flexible and are driven by a digital world. But, there are many risks associated with buying property in another country, and many Australians have found this out the hard way.
            </p>
          </div>

          <!-- Tip 2: Ownership Options -->
          <div class="tip-card">
            <div class="tip-number">2</div>
            <h3>Can a Foreigner Own Property in Bali?</h3>
            <p>
              There is only one way for foreigners to securely own property in Indonesia outright, instead of leasing real estate for a certain period of time: by setting up an Indonesian legal entity - a PT PMA. The ownership title of the property is called Hak Guna Bangunan (HGB).
            </p>
            <p>
              The Right to Build and Right to Use (Hak Pakai) titles provide you with clear legal grounding. A non-Indonesian citizen cannot own land in Indonesia. However, a foreigner can acquire a leasehold title (Hak Sewa) to land and buildings for a defined period of time.
            </p>
            <p>
              This title can be held in your own personal name and is 100% legal and protected by Indonesian law.
            </p>
          </div>

          <!-- Tip 3: Leasehold vs Freehold -->
          <div class="tip-card">
            <div class="tip-number">3</div>
            <h3>Leasehold vs Freehold</h3>
            <p>
              Having an investment strategy before buying in Bali is integral to the success of your purchase. This is why it is important to understand the differences between both a leasehold and freehold.
            </p>
            <p>
              To purchase a leasehold property in Bali means that you are leasing the land upon which your property is constructed. This is normally for a period of up to 25-30 years. As an investor, you have the rights to use the property during the agreed lease period; however, you do not have full ownership like a freehold property, which allows both full ownership over the property and its land.
            </p>
            <p>
              Before proceeding, it is important to highlight that for a foreign investor to own a freehold, they must set up a foreign investment company that is called a 'PT PMA'.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA 1: Lead Capture -->
    <section class="cta-inline section">
      <div class="container">
        <div class="cta-box">
          <h3>Download This Guide + Get Bali Off-Market Alerts</h3>
          <p>Get the complete PDF guide and be first to know about off-market villas in Bali</p>
          <button class="button-primary open-form-btn" data-form-type="guide">Get My Free Guide</button>
        </div>
      </div>
    </section>

    <!-- Ownership Details Section -->
    <section class="content-section section alt-bg">
      <div class="container">
        <div class="section-header">
          <h2>Ownership Options in Bali</h2>
          <p class="section-intro">Understanding your buying options and legal requirements</p>
        </div>

        <div class="tips-grid">
          <!-- Tip 4: Buying a Leasehold -->
          <div class="tip-card">
            <div class="tip-number">4</div>
            <h3>Buying a Leasehold</h3>
            <p>
              Investing in another country can be challenging and at times confusing, especially if you are not familiar with the local government laws and regulations. A leasehold purchase is the most popular with foreign investors due to it being more affordable than a freehold ownership.
            </p>
            <p>
              Private freehold owners are typically the ones who negotiate the sale of their leaseholds, and this is calculated in the way of millions of IDR per Acre of land per the duration of the lease term.
            </p>
            <p>
              Having a legally binding lease agreement in place is critical, which must outline the terms and conditions, including price, duration, and any renewal options if agreed upon. As part of this process, a local notary is pivotal to ensuring the lease is legally bound and valid.
            </p>
            <p>
              The signing of agreements in Bali is very different to that of other countries. In Bali, leases are negotiated and signed by the freehold owner of the land without the interruption of the Balinese Government.
            </p>
          </div>

          <!-- Tip 5: Understanding Lease Extensions -->
          <div class="tip-card">
            <div class="tip-number">5</div>
            <h3>Understanding Lease Extensions</h3>
            <p>
              Properties are typically leased for a duration of up to 30 years, with the option to extend if agreed upon within the original lease terms and conditions. However, getting the landowner to agree to an extension can at times be challenging because it is not lucrative due to the possibility of their land value increasing over time.
            </p>
            <p>
              A lease can be extended at any time during the lease period, and this must be agreed upon by the landowner at that time. Typically, most extensions are valued at the market rate at the time of extension.
            </p>
            <p>
              With land prices expected to increase over time, we always recommend that you extend your lease sooner rather than towards the end of your initial lease term. This will save you money in the long run.
            </p>
          </div>

          <!-- Tip 6: Buying a Freehold -->
          <div class="tip-card">
            <div class="tip-number">6</div>
            <h3>Buying a Freehold (PT PMA)</h3>
            <p>
              With the right guidance and support, purchasing a freehold in Bali is possible. However, it is far more complicated and can become frustrating for foreign investors. This is due to the Indonesian Government having regulations and laws in place to protect the priority interest of locals and limit overseas ownership of land.
            </p>
            <p>
              Creating a local team of professionals around you, such as a real estate agency and legal representatives, will be crucial to ensure you are meeting the set criteria that will enable you to purchase a freehold property in Bali. This will include acquiring the correct licenses, permits, and approvals.
            </p>
            <p>
              Indonesian law permits that any foreigners wanting to buy property in Bali as a freehold must set up a PT PMA, which is a foreign investment company. This is a legal requirement.
            </p>
            <p>
              <strong>For information about setting up a PT PMA to purchase a freehold property in Bali, please contact our team.</strong>
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Managing Your Investment Section -->
    <section class="content-section section">
      <div class="container">
        <div class="section-header">
          <h2>Managing Your Bali Villa Investment</h2>
          <p class="section-intro">Maximizing returns and managing your property effectively</p>
        </div>

        <div class="tip-card featured">
          <div class="tip-number">7</div>
          <h3>Managing Your Villa via Airbnb</h3>

          <p>
            Most foreign investors plan to place their villas onto short-term rental platforms to manage their bookings. It is important to carefully consider all your options before making a final decision. Some management companies in Bali can charge up to 15-20% on guest payments and therefore it may be more cost effective for you to manage the property yourself via platforms such as Airbnb. This will give you full administrative control over the finances.
          </p>
          <p>
            <strong>Please note that Airbnb charge roughly 7.5% on each guest booking.</strong>
          </p>

          <div class="comparison-table">
            <h4>Management Options Comparison:</h4>
            <div class="comparison-grid">
              <div class="comparison-item">
                <h5>Self-Management via Airbnb</h5>
                <ul>
                  <li><strong>Cost:</strong> 7.5% per booking</li>
                  <li>Full administrative control</li>
                  <li>Direct access to finances</li>
                  <li>Requires your time and involvement</li>
                </ul>
              </div>
              <div class="comparison-item">
                <h5>Property Management Company</h5>
                <ul>
                  <li><strong>Cost:</strong> 15-20% on guest payments</li>
                  <li>Hands-off approach</li>
                  <li>Professional management</li>
                  <li>Local presence for issues</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Buyers Agent Section -->
    <section class="content-section section alt-bg">
      <div class="container">
        <div class="section-header">
          <h2>Working with Edwards & Smith for Bali Villas</h2>
          <p class="section-intro">How we help Australians buy villas in Bali safely and confidently</p>
        </div>

        <div class="tip-card featured">
          <div class="tip-number">8</div>
          <h3>Why Work With Us?</h3>

          <p>
            We help everyday Australians purchase villas in Bali for investments, retirement, or even part-time living. Our Bali team guides each of our clients through the entire process of purchasing their dream villa.
          </p>

          <h4>Our Bali Services Include:</h4>
          <ul class="services-list">
            <li>Sourcing and inspecting the right villa</li>
            <li>Due diligence and comprehensive property checks</li>
            <li>Ownership options guidance (leasehold vs freehold and PT PMA setup)</li>
            <li>Expert negotiation to secure the best price</li>
            <li>Notary, legal requirements, and contracts</li>
            <li>Responsibilities and processes management</li>
            <li>Finance coordination</li>
            <li>Zoning and risk assessment</li>
          </ul>

          <div class="fee-structure">
            <h4>How Our Fees Are Structured</h4>
            <p>
              At Edwards & Smith, transparency is paramount. Our <a href="/services/full-buyers-agent-service">full buyers agent service</a> fee ranges from 2-5% of the purchase price depending on property value and complexity. We provide a clear quote upfront before you engage our services.
            </p>
            <p>
              For example, on a $500,000 USD villa, our fee would typically be less than $25,000 USD. Our fee is success-based—you only pay when you successfully purchase a property through our service.
            </p>
            <p>
              Unlike other services, we don't operate within strict timeframes. Whether the search takes three weeks or three months, our commitment remains unwavering—we will tirelessly pursue the perfect property for each and every client, ensuring their satisfaction and peace of mind throughout the process. See our <a href="/bali/recent-purchases">recent Bali villa purchases</a> and learn about our <a href="/services/property-evaluation-negotiation">property evaluation services</a>.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA 2: Second Lead Capture -->
    <section class="cta-inline section">
      <div class="container">
        <div class="cta-box">
          <h3>Ready to Explore Bali Villa Opportunities?</h3>
          <p>Get notified when new villa opportunities become available in Bali</p>
          <button class="button-primary open-form-btn" data-form-type="alerts">Get Bali Villa Alerts</button>
        </div>
      </div>
    </section>

    <!-- Final CTA Section -->
    <section class="cta-section section">
      <div class="container">
        <h2>Ready to Buy a Villa in Bali?</h2>
        <p>Book a free consultation to discuss your Bali property goals</p>
        <a href="/book-free-consultation" class="button-primary">Book Free Consultation</a>
      </div>
    </section>

    <!-- Progressive Profiling Modal -->
    <div id="lead-form-modal" class="modal">
      <div class="modal-content">
        <button class="modal-close">&times;</button>

        <!-- Step 1: Property Goal -->
        <div class="form-step active" data-step="1">
          <h3>What's your Bali property goal?</h3>
          <div class="button-group">
            <button class="choice-btn" data-value="investment">Investment</button>
            <button class="choice-btn" data-value="both">Retirement</button>
            <button class="choice-btn" data-value="owner_occupier">Part-time Living</button>
            <button class="choice-btn" data-value="holiday_home">Holiday Home</button>
          </div>
        </div>

        <!-- Step 2: Budget -->
        <div class="form-step" data-step="2">
          <h3>What's your budget range?</h3>
          <div class="button-group">
            <button class="choice-btn" data-value="<$500k AUD">&lt;$500k AUD</button>
            <button class="choice-btn" data-value="$500k-$1M AUD">$500k-$1M AUD</button>
            <button class="choice-btn" data-value="$1M-$2M AUD">$1M-$2M AUD</button>
            <button class="choice-btn" data-value="$2M+ AUD">$2M+ AUD</button>
          </div>
        </div>

        <!-- Step 3: Timeline -->
        <div class="form-step" data-step="3">
          <h3>When are you looking to buy?</h3>
          <div class="button-group">
            <button class="choice-btn" data-value="immediate">0-3 months</button>
            <button class="choice-btn" data-value="3_6_months">3-6 months</button>
            <button class="choice-btn" data-value="6_12_months">6-12 months</button>
            <button class="choice-btn" data-value="exploring">12+ months</button>
          </div>
        </div>

        <!-- Step 4: Contact Info -->
        <div class="form-step" data-step="4">
          <h3 id="modal-heading">Almost there! Where should we send your guide?</h3>
          <form id="contact-form" name="bali-guide-download">
            <input type="hidden" id="formId" value="ca10e16f-6931-40a3-96c5-d69087bdd5f1">
            <input type="hidden" id="pageUri" value="/bali-buyers-guide">
            <input type="hidden" id="leadSource" value="Bali Guide Download">
            <input type="hidden" id="location" value="bali">
            <input type="hidden" id="formType" value="guide">
            <input type="hidden" id="goal-value" name="purchase_purpose" value="">
            <input type="hidden" id="budget-value" name="budget" value="">
            <input type="hidden" id="timeline-value" name="purchase_timeline" value="">

            <div class="form-group">
              <label for="first-name">First Name *</label>
              <input type="text" id="first-name" name="firstName" required>
            </div>

            <div class="form-group">
              <label for="last-name">Last Name *</label>
              <input type="text" id="last-name" name="lastName" required>
            </div>

            <div class="form-group">
              <label for="email">Email *</label>
              <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group">
              <label for="phone">Phone</label>
              <input type="tel" id="phone" name="phone">
            </div>

            <div class="checkbox-group">
              <input type="checkbox" id="alerts" name="offMarketAlerts" checked>
              <label for="alerts">I want Bali off-market villa alerts</label>
            </div>

            <button type="submit" class="button-primary" id="guideSubmitButton">Get My Bali Guide →</button>
            <div id="guideFormMessage" class="form-message hidden"></div>
          </form>
        </div>

        <!-- Step 5: Confirmation -->
        <div class="form-step" data-step="5">
          <div class="success-message">
            <h3>✅ Check your email!</h3>
            <p id="success-message-line1">Your Bali Buyers Guide is on its way.</p>
            <p id="success-message-line2">We'll also send you off-market villa alerts matching your criteria.</p>
          </div>
        </div>
      </div>
    </div>
  </main>
  <Footer />
</Layout>

<style>
  .guide-hero {
    background-image: url('https://images.unsplash.com/photo-1537996194471-e657df975ab4?w=1600'), linear-gradient(135deg, rgba(90, 91, 84, 0.85), rgba(137, 139, 122, 0.85));
    background-size: cover;
    background-position: center;
    background-blend-mode: overlay;
    padding: 80px 20px;
    position: relative;
    text-align: center;
    color: var(--white);
  }

  .guide-hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(90, 91, 84, 0.7), rgba(137, 139, 122, 0.7));
    z-index: 0;
  }

  .guide-hero .container {
    position: relative;
    z-index: 1;
  }

  .guide-hero h1 {
    color: var(--white);
    margin-bottom: 15px;
  }

  .guide-hero .page-subtitle {
    font-family: var(--font-heading);
    font-size: 20px;
    color: var(--white);
  }

  .page-header {
    background-color: var(--white);
    padding: 20px 0;
  }

  .breadcrumb-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    color: var(--text-secondary);
  }

  .breadcrumb {
    font-size: 14px;
    color: var(--text-secondary);
  }

  .breadcrumb a {
    color: var(--text-secondary);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .breadcrumb a:hover {
    color: var(--primary-green);
    text-decoration: underline;
  }

  .breadcrumb span {
    color: var(--text-primary);
    font-weight: 500;
  }

  .last-updated {
    font-size: 14px;
    color: var(--text-light);
  }

  .content-section {
    background-color: var(--white);
  }

  .content-section.alt-bg {
    background-color: #f9f9f9;
  }

  .section-header {
    text-align: center;
    margin-bottom: 50px;
  }

  .section-header h2 {
    margin-bottom: 20px;
  }

  .section-intro {
    max-width: 800px;
    margin: 0 auto;
    color: var(--text-secondary);
    font-size: 18px;
  }

  .tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
  }

  .tip-card {
    background: var(--white);
    padding: 30px;
    border-radius: var(--border-radius-small);
    box-shadow: var(--box-shadow-subtle);
    position: relative;
  }

  .alt-bg .tip-card {
    background: var(--white);
  }

  .tip-card.featured {
    grid-column: 1 / -1;
  }

  .tip-number {
    position: absolute;
    top: -15px;
    left: 30px;
    background: var(--primary-green);
    color: var(--white);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-heading);
    font-size: 20px;
    font-weight: bold;
  }

  .tip-card h3 {
    color: var(--primary-green);
    margin-bottom: 20px;
    margin-top: 10px;
  }

  .tip-card h4 {
    color: var(--primary-green);
    margin-top: 25px;
    margin-bottom: 15px;
    font-size: 18px;
  }

  .tip-card h5 {
    color: var(--primary-green);
    margin-bottom: 10px;
    font-size: 16px;
  }

  .tip-card p {
    line-height: 1.7;
    margin-bottom: 15px;
  }

  .tip-card ul,
  .tip-card ol {
    margin-left: 20px;
    margin-bottom: 20px;
  }

  .tip-card li {
    margin-bottom: 10px;
    line-height: 1.6;
  }

  .comparison-table {
    margin-top: 30px;
    padding-top: 30px;
    border-top: 2px solid #e0e0e0;
  }

  .comparison-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-top: 20px;
  }

  .comparison-item {
    background: #f9f9f9;
    padding: 25px;
    border-radius: 8px;
  }

  .services-list {
    margin: 30px 0;
    margin-left: 20px;
  }

  .services-list li {
    margin-bottom: 15px;
    line-height: 1.6;
  }

  .fee-structure {
    margin-top: 40px;
    padding-top: 40px;
    border-top: 2px solid var(--primary-green);
  }

  .cta-inline {
    background-color: var(--white);
    padding: 40px 0;
  }

  .cta-box {
    background: linear-gradient(135deg, var(--primary-green), var(--olive-green));
    color: var(--white);
    padding: 50px;
    border-radius: var(--border-radius-small);
    text-align: center;
  }

  .cta-box h3 {
    color: var(--white);
    margin-bottom: 15px;
    font-size: 28px;
  }

  .cta-box p {
    margin-bottom: 25px;
    font-size: 18px;
  }

  .cta-section {
    background-color: var(--primary-green);
    color: var(--white);
    text-align: center;
  }

  .cta-section h2 {
    color: var(--white);
    margin-bottom: 15px;
  }

  .cta-section p {
    margin-bottom: 25px;
    font-size: var(--body-large);
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    align-items: center;
    justify-content: center;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    background-color: var(--white);
    padding: 40px;
    border-radius: var(--border-radius-small);
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
  }

  .modal-close {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 30px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--text-light);
  }

  .modal-close:hover {
    color: var(--text-primary);
  }

  .form-step {
    display: none;
  }

  .form-step.active {
    display: block;
  }

  .form-step h3 {
    color: var(--primary-green);
    margin-bottom: 30px;
    text-align: center;
    font-size: 24px;
  }

  .button-group {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }

  .choice-btn {
    padding: 20px;
    border: 2px solid var(--primary-green);
    background: var(--white);
    color: var(--primary-green);
    font-family: var(--font-heading);
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .choice-btn:hover {
    background: var(--primary-green);
    color: var(--white);
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .form-group input {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 4px;
    font-size: 16px;
  }

  .form-group input:focus {
    outline: none;
    border-color: var(--primary-green);
  }

  .checkbox-group {
    display: flex;
    align-items: center;
    margin-bottom: 25px;
  }

  .checkbox-group input[type="checkbox"] {
    width: auto;
    margin-right: 10px;
  }

  .success-message {
    text-align: center;
    padding: 40px 20px;
  }

  .success-message h3 {
    color: var(--primary-green);
    font-size: 32px;
    margin-bottom: 20px;
  }

  .success-message p {
    font-size: 18px;
    margin-bottom: 15px;
    line-height: 1.6;
  }

  @media (max-width: 768px) {
    .tips-grid {
      grid-template-columns: 1fr;
    }

    .comparison-grid {
      grid-template-columns: 1fr;
    }

    .services-grid {
      grid-template-columns: 1fr;
    }

    .button-group {
      grid-template-columns: 1fr;
    }

    .modal-content {
      padding: 30px 20px;
    }

    .cta-box {
      padding: 30px 20px;
    }
  }
</style>

<script is:inline>
  // Progressive Profiling Form Logic
  console.log('Initializing form...');
  const modal = document.getElementById('lead-form-modal');
  const openBtns = document.querySelectorAll('.open-form-btn');
  const closeBtns = document.querySelectorAll('.modal-close');
  const choiceBtns = document.querySelectorAll('.choice-btn');
  const contactForm = document.getElementById('contact-form');
  const modalHeading = document.getElementById('modal-heading');
  const submitButton = document.getElementById('guideSubmitButton');
  const formTypeInput = document.getElementById('formType');
  const leadSourceInput = document.getElementById('leadSource');

  console.log('Elements found:', {
    modal: !!modal,
    openBtns: openBtns.length,
    contactForm: !!contactForm,
    submitButton: !!submitButton
  });

  let formData = {
    goal: '',
    budget: '',
    timeline: ''
  };

  // Open modal
  openBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const formType = btn.dataset.formType || 'guide';
      formTypeInput.value = formType;

      // Update modal content based on form type
      if (formType === 'alerts') {
        modalHeading.textContent = 'Get Notified About Bali Villa Opportunities';
        submitButton.textContent = 'Get Bali Villa Alerts →';
        leadSourceInput.value = 'Bali Off-Market Alerts';
      } else {
        modalHeading.textContent = 'Almost there! Where should we send your guide?';
        submitButton.textContent = 'Get My Bali Guide →';
        leadSourceInput.value = 'Bali Guide Download';
      }

      modal.classList.add('active');
      showStep(1);
    });
  });

  // Close modal
  closeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      modal.classList.remove('active');
      resetForm();
    });
  });

  // Click outside modal to close
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.remove('active');
      resetForm();
    }
  });

  // Handle choice button clicks
  choiceBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const step = btn.closest('.form-step').dataset.step;
      const value = btn.dataset.value;

      if (step === '1') {
        formData.goal = value;
        showStep(2);
      } else if (step === '2') {
        formData.budget = value;
        showStep(3);
      } else if (step === '3') {
        formData.timeline = value;
        populateHiddenFields();
        showStep(4);
      }
    });
  });

  // Handle form submission
  contactForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    console.log('Form submission started');

    const submitButton = document.getElementById('guideSubmitButton');
    const formMessage = document.getElementById('guideFormMessage');

    submitButton.disabled = true;
    submitButton.textContent = 'Sending...';
    formMessage.classList.add('hidden');

    const formDataObj = new FormData(contactForm);
    const fields = {};

    // Debug: Log form data values
    console.log('FormData values:', {
      purchase_purpose: formDataObj.get('purchase_purpose'),
      budget: formDataObj.get('budget'),
      purchase_timeline: formDataObj.get('purchase_timeline')
    });

    fields.firstname = formDataObj.get('firstName');
    fields.lastname = formDataObj.get('lastName');
    fields.email = formDataObj.get('email');
    fields.phone = formDataObj.get('phone') || '';
    fields.wants_agent_call = formDataObj.get('offMarketAlerts') ? 'true' : 'false';
    fields.preferred_location = 'bali';
    fields.lead_source = document.getElementById('leadSource').value;
    fields.purchase_purpose = formDataObj.get('purchase_purpose') || '';
    fields.budget_range = formDataObj.get('budget') || '';
    fields.purchase_timeline = formDataObj.get('purchase_timeline') || '';

    const payload = {
      formId: document.getElementById('formId').value,
      fields: fields,
      context: {
        pageUri: window.location.href,
        pageName: 'Bali Buyers Guide',
        leadSource: 'Bali Guide Download'
      }
    };

    try {
      console.log('Sending to HubSpot:', payload);
      const response = await fetch('/api/hubspot-form', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      console.log('Response status:', response.status);
      const result = await response.json();
      console.log('Response data:', result);

      if (response.ok && result.success) {
        // Update success message based on form type
        const formType = formTypeInput.value;
        const line1 = document.getElementById('success-message-line1');
        const line2 = document.getElementById('success-message-line2');

        if (formType === 'alerts') {
          line1.textContent = 'You\'re all set!';
          line2.textContent = 'We\'ll send you off-market villa alerts matching your criteria.';
        } else {
          line1.textContent = 'Your Bali Buyers Guide is on its way.';
          line2.textContent = 'We\'ll also send you off-market villa alerts matching your criteria.';
        }

        showStep(5);
      } else {
        formMessage.textContent = 'There was an error. Please try again or email info@edwardsandsmith.com.au';
        formMessage.className = 'form-message error';
        formMessage.classList.remove('hidden');
      }
    } catch (error) {
      console.error('Form submission error:', error);
      formMessage.textContent = 'There was an error. Please try again or email info@edwardsandsmith.com.au';
      formMessage.className = 'form-message error';
      formMessage.classList.remove('hidden');
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = 'Get My Bali Guide →';
    }
  });

  function showStep(stepNumber) {
    document.querySelectorAll('.form-step').forEach(step => {
      step.classList.remove('active');
    });
    document.querySelector(`[data-step="${stepNumber}"]`).classList.add('active');
  }

  function populateHiddenFields() {
    document.getElementById('goal-value').value = formData.goal;
    document.getElementById('budget-value').value = formData.budget;
    document.getElementById('timeline-value').value = formData.timeline;
  }

  function resetForm() {
    formData = { goal: '', budget: '', timeline: '' };
    contactForm.reset();
    showStep(1);
  }
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Guide",
  "name": "Bali Buyers Guide 2025",
  "description": "Complete guide to buying villas in Bali including ownership options, leasehold vs freehold, PT PMA setup, legal requirements, and working with Australian buyers agents.",
  "provider": {
    "@type": "RealEstateAgent",
    "name": "Edwards & Smith Buyers Agents",
    "url": "https://www.edwardsandsmith.com.au"
  },
  "about": {
    "@type": "Place",
    "name": "Bali",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Bali",
      "addressRegion": "Bali",
      "addressCountry": "ID"
    }
  }
}
</script>
